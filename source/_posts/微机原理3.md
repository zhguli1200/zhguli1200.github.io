---
title: 微机原理（三）——指令系统
date: 2020-01-14 20:03:44
tags: 单片机
---

> 指令系统是汇编语言程序设计的基础，是微机原理的重点之一
> 学习指令系统，重点掌握以下几点
> 1. 指令功能
> 2. 寻址方式
> 3. 操作数的位数和存储结构
> 4. 对PSW的影响
> 5. 指令与存储区的对应关系
> 6. 各类指针及其指向的地址范围
> 7. 转移指令的转移范围
> 8. 指令字节数和机器周期数

<!-- more -->



# 1. 指令系统

## 1.1 指令格式

> \[标号:\]   操作码   \[操作数\]   \[;注释\]

1. 标号：表示指令的符号地址，相当于所在指令操作码的物理地址。
&emsp;&emsp;由英文字母开头的若干个字母、数字或下划线组成，长度为1-8个字符
&emsp;&emsp;不允许把之令主给付，寄存器号及伪指令字符作为语句的标号
&emsp;&emsp;三种情况常设置标号：完整程序的第一条指令、当一条指令作为其他转移指令的目的指令、作为检索用的表格首地址
&emsp;&emsp;相同标号在同一程序单位中只能出现一次
2. 操作码
&emsp;&emsp;可以是可执行指令的助记符，用于规定指令的功能，是任何一条语句中的必选项，汇编语言根据这一字段生成目标代码
&emsp;&emsp;也可以是伪指令的助记符，对汇编程序下命令，在汇编时起作用
3. 操作数：指令的操作数或操作数地址，可以是0~3个
&emsp;&emsp;可以采用字母或数字等多种表示形式：1.立即数（常数）；2.寄存器和特殊功能寄存器名；3.标号地址/$符号；4.带加、减运算符的表达式

## 1.2 指令符号约定
|符号|约定|
|:-|:-|
|Rn|工作寄存器，n=0\~7|
|@Ri|用于寄存器间接寻址的寄存器，i=0\~1|
|direct|8位片内直接地址|
|#data|8位立即数，数据范围00H\~FFH|
|#data16|16位立即数，数据范围0000H\~FFFFH|
|@DPTR|表示以DPTR为数据指针的片外间接寻址|
|Addr16|16位目标地址|
|Addr11|低11位目标地址|
|rel|8位带符号地址偏移量|
|bit|位地址|
|$|当前指令地址|
|/|加在位地址前面，表示对改为取反|
|(X)|X单元的内容|
|((X))|以X单元的内容为地址的单元的内容|
|⬅|数据传送方向|
|⇔|数据交换|

## 1.3 指令分类

MCS-51和AT89C52指令功能完全相同，所以本课学习的指令均为MCS-51的指令
分为四大类：
+ 数据传送：29条
+ 数据处理
+ 程序控制
+ 计算器状态管理

按照指令长度分为：
+ 单字节指令
+ 双字节指令
+ 三字节指令

按照指令执行时间分为：
+ 单机器周期指令
+ 双机器周期指令
+ 四机器周期指令

单字节有单周期、双周期、四周期
双字节有单周期、双周期
三字节有双周期
所以，指令长度长不一定执行时间长

保证程序功能的前提下，尽量采用指令字节少和执行时间短的指令，空间复杂性、时间复杂性都越小越好





# 2. 寻址方式

寻址就是寻找<u>操作数</u>或<u>PC值</u>

## 2.1 寄存器寻址——操作数存放在寄存器中

寻址范围：R0~R7，A(累加器的寄存器)、AB、DPTR
> ACC、10H代表累加器的地址，单独一个B代表地址

`MOV A,R0;(A)⬅(R0)`这里的R0叫做源，A为目或目的
`MUL AB`将A、B寄存器中数据（8位）相乘，结果为16位，低8位送A中，高8位送B中。

工作寄存器（00H\~1FH）：

|RS1|RS0|寄存器组|片内RAM地址|寄存器|
|-|-|-|-|-|
|0|0|第0组|00H\~07H|R0\~R7|
|0|1|第1组|08H\~0FH|R0\~R7|
|1|0|第2组|10H\~17H|R0\~R7|
|1|1|第3组|18H\~1FH|R0\~R7|

## 2.2 直接寻址——指令中直接给出操作数的地址（片内地址）

寻址范围:
可以是RAM中低128个单元：00H\~7FH
`MOV A,00H`
`MOV 30H,20H`
可以是SFR中80H\~FFH
`MOV A,90H;(A)⬅(P1)`
`MOV A,B`

## 2.3 寄存器间接寻址

将置顶寄存器的内容作为地址，该地址指定的单元内容作为操作数
寻址范围：
1. 内部RAM256字节，用Ri(i=0,1)和SP作间接寻址寄存器
2. 外部RAM或I/O口的64KB区域：与P2口配合使用，用Ri作间接寻址寄存器，地址范围从低256字节扩展到16位的64KB；用DPTR作间址寄存器可寻址整个64KB区域
`MOV A,@R0`R0等效为一个指针

## 2.4 立即寻址——在指令中直接给出操作数

`MOV A,#7AH`立即数7AH送累加器A，机器码为747AH
> 立即数前加“#”号，以区别直接地址。

## 2.5 变址间址寻址

——基址寄存器（DPTR或PC）+变址寄存器（A）的寻址方式

变址寻址方式只能对程序存储器进行寻址
主要用于查事先存好的表
`MOVC A,@A+DPTR ;(A)⬅((A)+(DPTR))`
`MOVC A,@A+PC   ;(A)⬅((A)+(PC))`
`JMP @A+DPTR    ;(PC)⬅((A)+(DPTR))`闪转

> ___注意___:当像楼上这样使用PC时，加法中的PC值并非此指令的所在地址
> 假设该指令所在地址为3F00H，(A)=50H，在本条指令马上就要被读取的时候，PC值为3F00H；
> 本条指令占一个字节，在计算机读取了本条指令之后，PC值变为3F01H，执行此命令过程中，A+PC=3F51H;
> 执行完此条指令后，(A)为3F51H地址处的内容。

## 2.6 相对寻址

——以当前的PC值为基准，加上指令中输出的相对偏移量(rel)而形成的PC值的寻址方式

相对寻址用于访问程序存储器，只出现在转移指令中
rel用补码表示，有正有负，转起来可前可后
`JC rel;4085H`本条指令占2个字节，PC值在执行时变为原来的PC+2

## 2.7 位寻址

为寻址范围：
1. 每部RAM的位寻址区，共16个单元的128位，字节地址位20H~2FH，位地址为00H~7FH，可用直接位地址或字节地址加位的表示方法。
&emsp;&emsp;1）直接使用位地址：`MOV C,7AH`C代表布尔累加器进位位，所以只能送1位进去，所以7AH是一个位地址。如果送给A的话，7AH代表存储单元地址
&emsp;&emsp;2) 单元地址加位的表示法：`MOV C,2FH.2`2FH.2即为7AH
2. 特殊功能寄存器SFH，位地址有4种表达方式
> 以对程序状态寄存器PSW辅助进位位AC进行操作为例
> PSW的地址为D0H，可被8整除
&emsp;&emsp;1）直接使用位地址：`MOV C,0D6H`
&emsp;&emsp;2) 单元地址加位的表示法：`MOV C,0D0H.6`
&emsp;&emsp;3) 位名称表示法：`MOV C,AC`
&emsp;&emsp;4) 专用寄存器符号加位的表示法：`MOV C,PSW.6`





# 3. 数据传送类指令（29条）

1. 内部RAM，特殊功能寄存器之间的数据传送，用MOV作为操作码助记符（15+1条）
2. 外部RAM与累加器A之间的数据传送，用MOVX作为指令操作码助记符（4条）
3. ROM读指令，即程序存储器ROM与累加器A之间数据指令，用MOVC作为指令操作码助记符(2条)
4. 堆栈操作指令，用PUSH/POP作为操作码助记符（2条）
5. 字节交换指令，用XCH(D)/SWAP作为操作码助记符（5条）
> 数据传送指令执行后特点：
一般不影响PSW中的标志位，只有当数据传送到累加器A时，PSW中的奇偶标志位P会改变

## 3.1 内部RAM，特殊功能寄存器之间的数据传输

## 3.2 外部RAM及I/O端口与累加器A之间的数据传送

> 扩展I/O端口与外部RAM统一编码，即扩展I/O端口地址占用外部RAM地址空间的某一单元，因此外部RAM及扩展I/O端口的读写操作指令，操作时序完全相同，___只能通过___累加器A存取外部RAM和扩展I/O端口，这类指令操作码助记符为“MOVX”，其中“X”的含义是“eXternal”（外部）

`MOVX A,@DPTR`
`MOVX @DPTR,A`
`MOVX A,@Ri`
`MOVX @Ri,A`

## 3.3 累加器A与程序存储器ROM之间的数据传送指令

> 为了取出存放在ROM中的表格数据，AT89C52提供了两条查表指令，这两条指令的操作码助记符为“MOVC”，其中“C”的含义是“Code”（代码），表示操作对象是程序存储器

`MOVC A,@A+DPTR`
`MOVC A,@A+PC`

## 3.4 堆栈操作

> 设置堆栈操作的目的是为了迅速保护信息

保护现场：
```
PUSH ACC
PUSH PSW
```
···
恢复现场：
```
PUSH PSW
PUSH ACC
```

## 3.5 字节交换指令

`XCH A,Rn`
`XCH A,40H`
`XCH A,@Ri`
`XCHD A,@Ri`A和Ri进行低4位i交换
`SWAP A`累加器内部高四位和低四位交换





# 4. 算术运算类指令

> 算术运算指令有加、减、乘、除及增1、减1和二-十进制调整指令
> 一般情况下，算术运算指令执行后会影响程序状态字寄存器PSW中相应的标志位

## 4.1 加法指令（8条）

### 4.1.1 不带进位的加法指令

+ `ADD A,Rn`            A⬅(A)+(Rn)
+ `ADD A,#data`     A⬅(A)+data
+ `ADD A,direct`   A⬅(A)+(direct)
+ `ADD A,@Ri`          A⬅(A)+((Ri))

### 4.1.2 带进位的加法指令（常用于多字节加法运算）

+ `ADDC A,Rn`         A⬅(A)+(Rn)+Cy
+ `ADDC A,#data`  A⬅(A)+data+Cy
+ `ADDC A,direct`A⬅(A)+(direct)+Cy
+ `ADDC A,@Ri`       A⬅(A)+((Ri))+Cy

## 4.2 减法指令（4条）

带借位的减法指令：
+ `SUBB A,Rn`             A⬅(A)+(Rn)-Cy+
+ `SUBB A,#data`      A⬅(A)+data-Cy
+ `SUBB A,direct`    A⬅(A)+(direct)-Cy
+ `SUBB A,@Ri`           A⬅(A)+((Ri))-Cy
在最低8位数相减之前，需要令Cy=0：`CLR C`

> 有些计算机提供了不带借位的减法“SUB”和带借位的减法“SUBC”

## 4.3 加一指令（5条）

> 只有操作对象为累加器A时，才影响奇偶标志位P

+ `INC A`
+ `INC Rn`
+ `INC direct`
+ `INC @Ri`
+ `INC DPTR`

> `INC A`仅影响奇偶标志位P，单字节指令
> `ADD A,#01H`影响所有标志位，双字节指令

## 4.4 减一指令（4条）

> 只有操作对象为累加器A时，才影响奇偶标志位P

+ `DEC A`
+ `DEC Rn`
+ `DEC direct`
+ `DEC @Ri`
> DPTR可以看作两个特殊功能寄存器DPH（高八位）和DPL（低八位），这俩属于楼上direct
> `DEC DPL`就可以实现对DPTR减1，除非DPL=0

## 4.5 乘除指令（2条）

> 提供8位__无符号数__乘法指令和除法指令

`MUL AB`BA⬅(A)×(B)，B存结果的高八位，A存结果的低八位
`DIV AB`A(商)⬅(A)÷(B)，B(余数)⬅(A)÷(B)

> 乘法对标志位的影响：
> + Cy总是清0
> + 当积大于255时，OV=1，否则OV=0
> + P仍为累加器A的奇偶校验位
>
> 除法对标志位的影响：
> + Cy总是清0
> + 当除数为0时，除法没有意义，OV=1；否则OV=0
> + P仍为累加器A的奇偶校验位

## 4.6 十进制加法调整指令（1条）

`DA A`

+ 调整规律：若AC=1或低4位大于9，则加06H；若Cy=1或高4位大于9，则加60H；
+ 该指令使用时需放在ADD或ADDC指令后，不能单独使用`DA A`指令将累加器A中的内容转化为BCD码
+ MCS-51没有提供BCD码减法调整指令，但可以通过补码概念，将BCD码减法运算变成BCD码加法运算
+ 该指令不影响溢出标志位OV




未完待续



